<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>components/video/Video.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module.html#.exports">exports</a></li><li><a href="module.exports_module.exports.html">exports</a></li><li><a href="ProgressBar_ProgressBar.html">ProgressBar</a></li><li><a href="VideoPlayerContainer_VideoPlayerContainer.html">VideoPlayerContainer</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ActionMap">ActionMap</a></li><li><a href="global.html#basicTime">basicTime</a></li><li><a href="global.html#BufferRecord">BufferRecord</a></li><li><a href="global.html#calculateClickPosition">calculateClickPosition</a></li><li><a href="global.html#componentDidMount">componentDidMount</a></li><li><a href="global.html#componentWillReceiveProps">componentWillReceiveProps</a></li><li><a href="global.html#componentWillUnmount">componentWillUnmount</a></li><li><a href="global.html#end">end</a></li><li><a href="global.html#findPos">findPos</a></li><li><a href="global.html#getBufferedSections">getBufferedSections</a></li><li><a href="global.html#getEventPosition">getEventPosition</a></li><li><a href="global.html#getIsPlaying">getIsPlaying</a></li><li><a href="global.html#handleChange">handleChange</a></li><li><a href="global.html#handleClick">handleClick</a></li><li><a href="global.html#handleDragStart">handleDragStart</a></li><li><a href="global.html#handleDragStop">handleDragStop</a></li><li><a href="global.html#handleMouseDown">handleMouseDown</a></li><li><a href="global.html#handleMouseEnter">handleMouseEnter</a></li><li><a href="global.html#handleMouseLeave">handleMouseLeave</a></li><li><a href="global.html#handleMouseMove">handleMouseMove</a></li><li><a href="global.html#handleMouseUp">handleMouseUp</a></li><li><a href="global.html#handleStreamInitialized">handleStreamInitialized</a></li><li><a href="global.html#instance">instance</a></li><li><a href="global.html#key">key</a></li><li><a href="global.html#map2QueryString">map2QueryString</a></li><li><a href="global.html#mute">mute</a></li><li><a href="global.html#pause">pause</a></li><li><a href="global.html#play">play</a></li><li><a href="global.html#playbackRate">playbackRate</a></li><li><a href="global.html#queryString2Map">queryString2Map</a></li><li><a href="global.html#removeEventListeners">removeEventListeners</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#retrieveManifest">retrieveManifest</a></li><li><a href="global.html#seek">seek</a></li><li><a href="global.html#seekByMilliseconds">seekByMilliseconds</a></li><li><a href="global.html#seekByPercent">seekByPercent</a></li><li><a href="global.html#setAutoPlay">setAutoPlay</a></li><li><a href="global.html#shouldComponentUpdate">shouldComponentUpdate</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#startOrResetVideoUpdateLoop">startOrResetVideoUpdateLoop</a></li><li><a href="global.html#togglePlay">togglePlay</a></li><li><a href="global.html#unmute">unmute</a></li><li><a href="global.html#updateVideoState">updateVideoState</a></li><li><a href="global.html#video">video</a></li><li><a href="global.html#VideoEventKeys">VideoEventKeys</a></li><li><a href="global.html#VideoPlayerOptions">VideoPlayerOptions</a></li><li><a href="global.html#VideoPlayerState">VideoPlayerState</a></li><li><a href="global.html#VideoPlayerTimeState">VideoPlayerTimeState</a></li><li><a href="global.html#volume">volume</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">components/video/Video.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from 'react';
import classNames from 'classnames';
import invariant from 'invariant';
import PropTypes from 'prop-types';

import VideoPlayerActions from '../../data/VideoPlayerActions';

import css from './Video.css';

/**
 * HMTLVideoElementMethods
 */
export const VideoEventKeys = [
  'play',
  'pause',
  'playbackRate',
  'mute',
  'unmute',
  'volume',
  'seekByPercent',
  'seekByMilliseconds',
  'seek'
];

export default class Video extends Component {
  /**
   * Setup
   * @param Object} props
   */
  constructor(props) {
    super(props);

    [].concat(
      VideoEventKeys,
      [
        'updateVideoState',
        'handleClick'
      ]
    )
      .forEach((key) => {
        this[key] = this[key].bind(this);
      });
  }

  /**
   * Listen
   */
  componentDidMount() {
    // clean video player state before initializing
    VideoPlayerActions.reset();
    this.listeners = VideoEventKeys.map(key => VideoPlayerActions.addChangeListener(key, this[key]));
    this.updateVideoState();
    this.startOrResetVideoUpdateLoop();
    VideoPlayerActions.update({
      frameRate: this.props.frameRate
    });
  }

  /**
   * Update the framerate
   * @param {Object} nextProps
   */
  componentWillReceiveProps(nextProps) {
    VideoPlayerActions.update({
      frameRate: nextProps.frameRate
    });
  }

  /**
   * Cleanup
   */
  componentWillUnmount() {
    this.listeners.forEach(listener => listener.remove());
    clearInterval(this.videoProgressId);
  }

  /**
   * Seek to a specific percent in the video
   * @param {Number} percent
   */
  seekByPercent(percent) {
    invariant(
      !isNaN(percent) &amp;&amp; percent >= 0 &amp;&amp; percent &lt;= 1,
      'percent is not number between 0 and 1'
    );
    this.seek(this.video.duration * percent);
  }

  /**
   * Seek to a specific point in the video by milliseconds
   * @param {Number} time
   */
  seekByMilliseconds(time) {
    this.seek(time / 1000);
  }

  /**
   * Seek to a specific time
   * @param {Number} currentTime
   */
  seek(currentTime) {
    invariant(
      !isNaN(currentTime),
      'currentTime is not a number'
    );
    this.video.currentTime = currentTime;
  }

  /**
  * Start or restart the loop that updates time and other video stats. We only
  * update it every 33 so the client responds faster. CSS transitions should
  * match this so the progress bar is still smooth
  */
  startOrResetVideoUpdateLoop() {
    clearInterval(this.videoProgressId);
    this.videoProgressId = setInterval(this.updateVideoState, 33);
  }

  /**
   * Helper function to quickly access the video html object
   */
  get video() {
    return this.refs.video;
  }

  /**
   * Play
   */
  play() {
    this.video.play();
  }

  /**
   * Toggle play state
   */
  togglePlay() {
    if (this.video.paused) {
      this.play();
    } else {
      this.pause();
    }
  }

  /**
   * Pause
   */
  pause() {
    this.video.pause();
  }

  /**
   * Set the playback speed of the video
   * @param {Number} playbackRate
   */
  playbackRate(playbackRate) {
    invariant(
      !isNaN(playbackRate),
      'playbackRate is not a number'
    );
    this.video.playbackRate = playbackRate;
  }

  /**
   * Mute the video
   */
  mute() {
    this.video.muted = true;
  }

  /**
   * Unmute the video
   */
  unmute() {
    this.video.muted = false;
  }

  /**
   * Set the volume of the video element
   * @param {Number} volume
   */
  volume(volume) {
    invariant(
      !isNaN(volume) &amp;&amp; volume >= 0 &amp;&amp; volume &lt;= 1,
      'volume is not number between 0 and 1'
    );
    this.video.volume = volume;
  }

  /**
   * Get the state and update the stores
   */
  updateVideoState(video = this.refs.video) {
    VideoPlayerActions.updateState(video);
  }


  /**
   * find left x position of a dom node relative to client.
   * @param  {Object} node
   * @return {Number}      left edge x coordinate
   */
  findPos(key, node) {
    let val = node[key];
    while ((node = node.offsetParent)) {
      val += node[key];
    }
    return val;
  }

  /**
   * Calculates the click position relative to the native
   * video dimensions
   * @param {Event} event
   */
  calculateClickPosition(event) {
    const video = this.video;

    // Get mouse position
    const mouseX = event.pageX - this.findPos('offsetLeft', video);
    const mouseY = event.pageY - this.findPos('offsetTop', video);

    const {
      videoWidth,
      videoHeight,
      offsetWidth,
      offsetHeight
    } = this.video;

    const videoRatio = videoWidth / videoHeight;
    const containerRatio = offsetWidth / offsetHeight;

    let height = offsetHeight;
    let width = offsetWidth;
    if (containerRatio > videoRatio) {
      width = Math.floor(offsetHeight * videoRatio);
    } else {
      height = Math.floor(offsetWidth / videoRatio);
    }

    const widthPadding = Math.floor((offsetWidth - width) / 2);
    const heightPadding = Math.floor((offsetHeight - height) / 2);

    const scaleRatio = videoWidth / width;

    const x = (mouseX - widthPadding) * scaleRatio;
    const y = (mouseY - heightPadding) * scaleRatio;

    return {
      x,
      y
    };
  }

  /**
   * Handles clicks on the video
   * @param {Event} event
   */
  handleClick(event) {
    if (typeof this.props.onClick === 'function') {
      this.props.onClick(event, this.calculateClickPosition(event));
    }

    // Let the prop prevent this
    if (!event.defaultPrevented) {
      this.togglePlay();
    }
  }

  /**
   * Render
   */
  render() {
    const {
      className,
      onError,
      onPlay,
      onPause,
      onCanPlay,
      onEnded,
      onLoadedMetadata,
      onCanPlayThrough,
      onSeeking,
      onWaiting,
      onContextMenu,
      autoPlay,
      src,
      loop
    } = this.props;
    return (
      &lt;video
        className={classNames(className, css.container)}
        ref='video'
        src={src}
        autoPlay={autoPlay}
        onClick={this.handleClick}
        onCanPlay={onCanPlay}
        onCanPlayThrough={onCanPlayThrough}
        onError={onError}
        onPlay={onPlay}
        onPause={onPause}
        onEnded={onEnded}
        onLoadedMetadata={onLoadedMetadata}
        onSeeking={onSeeking}
        onWaiting={onWaiting}
        onContextMenu={onContextMenu}
        loop={loop}
      />
    );
  }
}

/**
 * Defaults
 */
Video.defaultProps = {
  className: undefined,
  onClick: undefined,
  onError: undefined,
  onPlay: undefined,
  onPause: undefined,
  onCanPlay: undefined,
  onCanPlayThrough: undefined,
  onEnded: undefined,
  onLoadedMetadata: undefined,
  onSeeking: undefined,
  onWaiting: undefined,
  onContextMenu: undefined,
  containerHeight: undefined,
  containerWidth: undefined,
  src: undefined,
  frameRate: 30,
  autoPlay: false,
  loop: false
};

/**
 * Types
 */
Video.propTypes = {
  autoPlay: PropTypes.bool,
  className: PropTypes.string,
  onClick: PropTypes.func,
  onError: PropTypes.func,
  onPlay: PropTypes.func,
  onPause: PropTypes.func,
  onCanPlay: PropTypes.func,
  onCanPlayThrough: PropTypes.func,
  onEnded: PropTypes.func,
  onLoadedMetadata: PropTypes.func,
  onSeeking: PropTypes.func,
  onWaiting: PropTypes.func,
  onContextMenu: PropTypes.func,
  src: PropTypes.string,
  containerHeight: PropTypes.number,
  containerWidth: PropTypes.number,
  frameRate: PropTypes.number,
  loop: PropTypes.bool
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Apr 09 2018 16:09:32 GMT-0700 (PDT) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
